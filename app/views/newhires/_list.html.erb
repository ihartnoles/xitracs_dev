<fieldset class="round" >
	<div class="row">
	
		  <% if @newhires.count > 0 %>
			<div class="span4" align="left">
				<h4><%= @newhire_count %> New Hire<% if @newhires.count > 1 %>s<% end %></h4>
			</div>
				<%#= button_to "Assign", '', :id => 'test',:class => "btn btn-mini btn-primary" ,:method => :post, :title => 'Start Pre-Credentialing ', :rel => 'tooltip' %>

			 <% if current_user.name == "mwalsh8" || current_user.name == "ihartstein" ||  current_user.name == "jcramer" %>
			  <div align="right">
				<strong>Assign to:</strong>
				 <%= select('send_to', 'notify',
                          options_for_select(@send_to_notify.collect{ |u| [u.displayname, u.id]}), {:include_blank => 'None'})%>
             </div>
             <% end %>
		  <% end %>
	
    </div>

		<% if @newhires.nil? || @newhires.count == 0 %>
			<div class="alert">
		  			<center>No New Hires Assigned to Me</center>
		  	</div>

		<% else %>
				<table class="table table-condensed table-hover" id="example">
				  <% if current_user.name == "mwalsh8" || current_user.name == "ihartstein" ||  current_user.name == "jcramer" %>
					<th>Assign</th>
				  <% end %>
				  <th>Last</th>
				  <th>First</th>
				  <th>School</th>
				  <th>Department</th>
				  <th>Added on</th>
				  <th>Assigned to</th>
				   <% if current_user.name == "mwalsh8" || current_user.name == "ihartstein" ||  current_user.name == "jcramer" %>
				  	<th colspan="2" >Actions</th>
				   <% else %>
				   	<th colspan="2" >Actions</th>
				  <% end %>
				    <% @newhires.each do |newhire| %>
						  <tr>

						  	<% if current_user.name == "mwalsh8" || current_user.name == "ihartstein" ||  current_user.name == "jcramer" %>
						  		<td>
							  		<%= check_box_tag 'newhire_ids', newhire.id, false,:class => 'assign' %>
							  	</td>
							<% end %>

						  	<td><%= newhire.last_name %></td>
						  	<td><%= newhire.first_name %></td>
						  	<td><%= newhire.school_name %></td>
						  	<td><%= newhire.dept_name %></td>
						    <td><%= newhire.created_at.strftime('%m/%d/%Y %l:%M %P') %></td>
						    <td><%= User.find(newhire.assigned_to).name%></td>
						  	<td>
						  		<%#= link_to image_tag('/assets/Preview_16x16.png'), newhireshowcourses_path(:id => newhire, :dept_id => newhire.department_id), :title => 'See details ', :rel => 'tooltip' %>

						  		<%  if newhire.assigned_to == current_user.id %>
							  		<%= link_to image_tag('/assets/Edit_16x16.png'), edit_newhire_path(:id => newhire, :dept_id => newhire.department_id),:title => 'Edit new hire', :rel => 'tooltip'
	                                    %>

							  		<%= link_to image_tag('/assets/Delete_16x16.png'),  newhire_delete_newhire_path(:id => newhire, :dept_id => newhire.department_id), :method => :delete_newhire, :class => "destroy", :confirm => "Are you sure you want to delete this new hire entry?",:title => 'Delete new hire', :rel => 'tooltip'
	                                    %>     
	                            <% end %>   

						   </td>
						   <td>						   		 
						   	<% if newhire.assigned_to == current_user.id %>
						   	
						   		 <%= button_to "Start", newhireshowcourses_path(:id => newhire, :dept_id => newhire.department_id), :class => "btn btn-mini btn-primary" ,:method => :post, :title => 'Start Pre-Credentialing ', :rel => 'tooltip' %>

						   	<% else %>

						   		<%= button_to "View", newhireshowcourses_path(:id => newhire, :dept_id => newhire.department_id), :class => "btn btn-mini btn-primary" ,:method => :get, :title => 'View details ', :rel => 'tooltip' %>

						   	<% end %>
						   </td>
						  </tr>
					  <% end %>
				</table>  
		<% end %>

</fieldset>

<script type="text/javascript">
jQuery(document).ready(function(){
      
       jQuery('#send_to_notify').change(function(){
          var allVals = [];
          
          jQuery('.assign:checked').each(function() {
		       allVals.push(jQuery(this).val());		      
		   });

          //alert(allVals);
       
          var i;
		  for (i = 0; i < allVals.length; ++i) {
		   jQuery.post(
		      '/newhires/assign_to', 
		      {id:allVals[i], assigned_to:jQuery('#send_to_notify').val()});
           } 
		  //reload
		  location.reload();
       });
      
});
</script>